openapi: 3.0.3
info:
  title: Study Management API
  version: 0.1.0
servers:
  - url: /api
paths:
  /auth/signup:
    post:
      summary: Create account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthUser'
        '400':
          $ref: '#/components/responses/BadRequest'
  /auth/login:
    post:
      summary: Sign in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /auth/logout:
    post:
      summary: Sign out
      responses:
        '204':
          description: No Content
  /users/me:
    get:
      summary: Get current user profile
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '401':
          $ref: '#/components/responses/Unauthorized'
    patch:
      summary: Update current user profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProfileUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /journals:
    get:
      summary: List journal entries (metadata)
      parameters:
        - in: query
          name: from
          schema:
            type: string
          description: Inclusive start date (YYYY-MM-DD)
        - in: query
          name: to
          schema:
            type: string
          description: Inclusive end date (YYYY-MM-DD)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JournalEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Create or replace a journal entry for a date
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JournalUpsertRequest'
      responses:
        '200':
          description: Upserted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntry'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /journals/{date}:
    get:
      summary: Get journal entry by date
      parameters:
        - in: path
          name: date
          required: true
          schema:
            type: string
          description: YYYY-MM-DD
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JournalEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete journal entry by date
      parameters:
        - in: path
          name: date
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '401':
          $ref: '#/components/responses/Unauthorized'
  /friends:
    get:
      summary: List friends
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PublicUser'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /friends/requests:
    get:
      summary: List incoming/outgoing friend requests
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FriendRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Send friend request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FriendRequestCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FriendRequest'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /friends/requests/{requestId}/accept:
    post:
      summary: Accept friend request
      parameters:
        - in: path
          name: requestId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FriendRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /friends/requests/{requestId}/decline:
    post:
      summary: Decline friend request
      parameters:
        - in: path
          name: requestId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FriendRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /friends/{userId}:
    delete:
      summary: Remove friend
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '401':
          $ref: '#/components/responses/Unauthorized'
  /chats:
    get:
      summary: List chats for current user
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Chat'
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: Create direct or group chat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Chat'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /chats/{chatId}:
    get:
      summary: Get chat details (includes members)
      parameters:
        - in: path
          name: chatId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /chats/{chatId}/messages:
    get:
      summary: Get message history
      parameters:
        - in: path
          name: chatId
          required: true
          schema:
            type: string
        - in: query
          name: before
          schema:
            type: string
          description: Message cursor
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Message'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Send message
      parameters:
        - in: path
          name: chatId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Message'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /chats/{chatId}/leave:
    post:
      summary: Leave group chat
      parameters:
        - in: path
          name: chatId
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /advice:
    get:
      summary: List study advice items
      parameters:
        - in: query
          name: category
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StudyAdviceItem'
  /qna/questions:
    get:
      summary: Browse questions
      parameters:
        - in: query
          name: q
          schema:
            type: string
          description: Keyword search query
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
    post:
      summary: Create a question
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /qna/questions/{questionId}:
    get:
      summary: View question detail
      parameters:
        - in: path
          name: questionId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionDetail'
        '404':
          $ref: '#/components/responses/NotFound'
  /qna/questions/{questionId}/answers:
    post:
      summary: Post an answer
      parameters:
        - in: path
          name: questionId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AnswerCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Answer'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /qna/votes:
    post:
      summary: Vote on a question or answer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Vote'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /qna/reports:
    post:
      summary: Report abusive content
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Report'
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string

    AuthUser:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/PublicUser'

    PublicUser:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        displayName:
          type: string

    SignUpRequest:
      type: object
      required: [email, username, password]
      properties:
        email:
          type: string
        username:
          type: string
        password:
          type: string

    LoginRequest:
      type: object
      required: [identifier, password]
      properties:
        identifier:
          type: string
          description: Email or username
        password:
          type: string

    Profile:
      type: object
      properties:
        userId:
          type: string
        displayName:
          type: string
        bio:
          type: string
        visibility:
          type: string
          enum: [public, friends-only]
        avatarUrl:
          type: string

    ProfileUpdateRequest:
      type: object
      properties:
        displayName:
          type: string
        bio:
          type: string
        visibility:
          type: string
          enum: [public, friends-only]
        avatarUrl:
          type: string

    JournalEntry:
      type: object
      properties:
        date:
          type: string
        content:
          type: string
        updatedAt:
          type: string

    JournalUpsertRequest:
      type: object
      required: [date, content]
      properties:
        date:
          type: string
        content:
          type: string

    FriendRequest:
      type: object
      properties:
        id:
          type: string
        requesterId:
          type: string
        recipientId:
          type: string
        status:
          type: string
          enum: [pending, accepted, declined, canceled]
        createdAt:
          type: string

    FriendRequestCreate:
      type: object
      required: [username]
      properties:
        username:
          type: string
          description: Recipient username

    Chat:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [direct, group]
        name:
          type: string

    ChatCreateRequest:
      type: object
      required: [type, memberIds]
      properties:
        type:
          type: string
          enum: [direct, group]
        name:
          type: string
        memberIds:
          type: array
          items:
            type: string

    ChatDetail:
      allOf:
        - $ref: '#/components/schemas/Chat'
        - type: object
          properties:
            members:
              type: array
              items:
                $ref: '#/components/schemas/PublicUser'

    Message:
      type: object
      properties:
        id:
          type: string
        chatId:
          type: string
        senderId:
          type: string
        content:
          type: string
        createdAt:
          type: string

    MessageCreateRequest:
      type: object
      required: [content]
      properties:
        content:
          type: string

    StudyAdviceItem:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        category:
          type: string
        steps:
          type: array
          items:
            type: string

    Question:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        body:
          type: string
        tags:
          type: array
          items:
            type: string
        createdAt:
          type: string

    QuestionDetail:
      allOf:
        - $ref: '#/components/schemas/Question'
        - type: object
          properties:
            answers:
              type: array
              items:
                $ref: '#/components/schemas/Answer'

    QuestionCreateRequest:
      type: object
      required: [title, body]
      properties:
        title:
          type: string
        body:
          type: string
        tags:
          type: array
          items:
            type: string

    Answer:
      type: object
      properties:
        id:
          type: string
        questionId:
          type: string
        body:
          type: string
        createdAt:
          type: string

    AnswerCreateRequest:
      type: object
      required: [body]
      properties:
        body:
          type: string

    Vote:
      type: object
      properties:
        targetType:
          type: string
          enum: [question, answer]
        targetId:
          type: string
        direction:
          type: string
          enum: [up, down]

    VoteRequest:
      type: object
      required: [targetType, targetId, direction]
      properties:
        targetType:
          type: string
          enum: [question, answer]
        targetId:
          type: string
        direction:
          type: string
          enum: [up, down]

    Report:
      type: object
      properties:
        id:
          type: string
        targetType:
          type: string
          enum: [question, answer]
        targetId:
          type: string
        reason:
          type: string
        status:
          type: string
          enum: [open, reviewed, actioned]
        createdAt:
          type: string

    ReportCreateRequest:
      type: object
      required: [targetType, targetId, reason]
      properties:
        targetType:
          type: string
          enum: [question, answer]
        targetId:
          type: string
        reason:
          type: string
